<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Ejercicio de Phaser - Opcional 1.</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header id="title-block-header">
<h1 class="title">Ejercicio de Phaser - Opcional 1.</h1>
</header>
<p>Realiza estos ejercicios en orden incremental. Solo es necesario
entregar el último mediante un zip de todo el proyecto.</p>
<p>Recuerda que puedes consultar la documentación (por ejemplo, <a
href="https://cvdof.ucm.es/moodle/mod/url/view.php?id=1115362">PhaserLab</a>,
<a href="https://cvdof.ucm.es/moodle/mod/url/view.php?id=868127">API de
Phaser</a>, <a href="http://developer.mozilla.org">la MDN</a>…),
realizar búsquedas en Internet, etc.</p>
<h1 id="preparación">Preparación</h1>
<h2
id="ejecutar-un-juego-de-phaser-con-una-única-escena-y-una-imagen">Ejecutar
un juego de Phaser con una única escena y una imagen</h2>
<p>Crea un carpeta y en su interior genera la siguiente estructura:
-ejercicioPhaser -lib -phaser.js -assets - castle.gif -css -game.css
-src -scenes -maingame.js -enemies -enemy.js -game.js</p>
<pre><code>-index.html</code></pre>
<p>También puedes añadir la carpeta types y el jsconfig visto en clase y
en los ejemplos del campus.</p>
<p>El archivo <code>index.html</code> debe contener lo siguiente:</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;!DOCTYPE </span>html<span class="dt">&gt;</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;html</span> <span class="er">lang</span><span class="ot">=</span><span class="st">&quot;es&quot;</span><span class="kw">&gt;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;head&gt;</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;meta</span> <span class="er">charset</span><span class="ot">=</span><span class="st">&quot;UTF-8&quot;</span><span class="kw">&gt;</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;link</span> <span class="er">rel</span><span class="ot">=</span><span class="st">&quot;stylesheet&quot;</span> <span class="er">href</span><span class="ot">=</span><span class="st">&quot;./css/game.css&quot;</span><span class="kw">&gt;</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;script</span> <span class="er">src</span><span class="ot">=</span><span class="st">&quot;./lib/phaser.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;title&gt;</span>¡Juego con Phaser!<span class="kw">&lt;/title&gt;</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/head&gt;</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;body&gt;</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;h1&gt;</span>Ejercicio opcional Phaser<span class="kw">&lt;/h1&gt;</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;div</span> <span class="er">id</span><span class="ot">=</span><span class="st">&#39;juego&#39;</span><span class="kw">&gt;&lt;/div&gt;</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;script</span> <span class="er">src</span><span class="ot">=</span><span class="st">&quot;./src/game.js&quot;</span><span class="ot"> type=</span><span class="st">&quot;module&quot;</span><span class="kw">&gt;&lt;/script&gt;</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/body&gt;</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/html&gt;</span></span></code></pre></div>
<p>Vamos a ver ahora que debemos tener en <code>game.js</code>:</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> Maingame <span class="im">from</span> <span class="st">&#39;./scenes/maingame.js&#39;</span><span class="op">;</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"> * Creamos el archivo de configuración del juego y creamos</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"> * la clase Game de Phaser, encargada de crear e iniciar el juego.</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"> * Doc: https://newdocs.phaser.io/docs/3.86.0/Phaser.Types.Core.GameConfig</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> config <span class="op">=</span> {</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> Phaser<span class="op">.</span><span class="at">AUTO</span><span class="op">,</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">parent</span><span class="op">:</span> <span class="st">&#39;juego&#39;</span><span class="op">,</span> <span class="co">//ID del elemento del DOM en el que se anidará el Canvas que genere Phaser, si no, por defecto, irá al final del body</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">width</span><span class="op">:</span>  <span class="dv">656</span><span class="op">,</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">height</span><span class="op">:</span> <span class="dv">376</span><span class="op">,</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">pixelArt</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">scale</span><span class="op">:</span> {</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>        <span class="dt">autoCenter</span><span class="op">:</span> Phaser<span class="op">.</span><span class="at">Scale</span><span class="op">.</span><span class="at">CENTER_HORIZONTALLY</span><span class="op">,</span> <span class="co">//Le decimos que se centre en pantalla</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Configuramos phaser para que se adapte al tamaño de pantalla donde ejecutadmos</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>        <span class="co">// con un mínimo y un máximo de tamaño</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>        <span class="dt">mode</span><span class="op">:</span> Phaser<span class="op">.</span><span class="at">Scale</span><span class="op">.</span><span class="at">FIT</span><span class="op">,</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>        <span class="dt">min</span><span class="op">:</span> {</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>            <span class="dt">width</span><span class="op">:</span> <span class="dv">328</span><span class="op">,</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>            <span class="dt">height</span><span class="op">:</span> <span class="dv">188</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>        <span class="dt">max</span><span class="op">:</span> {</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>            <span class="dt">width</span><span class="op">:</span> <span class="dv">1312</span><span class="op">,</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>            <span class="dt">height</span><span class="op">:</span> <span class="dv">752</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>        <span class="dt">zoom</span><span class="op">:</span> <span class="dv">1</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>    <span class="dt">scene</span><span class="op">:</span> [Maingame]<span class="op">,</span> <span class="co">//Aquí metemos todas las escenas que tendrá nuestro juego (su clase, luego cambiaremos de una a otra mediante el id)</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>    <span class="dt">physics</span><span class="op">:</span> {  </span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">default</span><span class="op">:</span> <span class="st">&#39;arcade&#39;</span><span class="op">,</span> <span class="co">//Tenemos físicas simple, arcade</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>        <span class="dt">arcade</span><span class="op">:</span> { </span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>            <span class="dt">gravity</span><span class="op">:</span> { <span class="dt">y</span><span class="op">:</span> <span class="dv">200</span> }<span class="op">,</span> <span class="co">//Tenemos gravedad, podemos modificarla para aumentar su fuera o disminuirla</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>            <span class="dt">debug</span><span class="op">:</span> <span class="kw">true</span> <span class="co">// Aquí indicamos si queremos que Phaser pinte los cuerpos y fuerzas de los objetos con físicas</span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>        <span class="dt">checkCollision</span><span class="op">:</span> {</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>            <span class="dt">up</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>            <span class="dt">down</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>            <span class="dt">left</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>            <span class="dt">right</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>    <span class="dt">title</span><span class="op">:</span> <span class="st">&quot;ejercicio opcional&quot;</span><span class="op">,</span></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>    <span class="dt">version</span><span class="op">:</span> <span class="st">&quot;1.0.0&quot;</span></span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a><span class="co">    Instanciamos Phaser con la configuración deseada, Phaser se encargará de lanzar la primera escena del array de escenas</span></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a><span class="kw">new</span> Phaser<span class="op">.</span><span class="fu">Game</span>(config)<span class="op">;</span> </span></code></pre></div>
<p>Lo siguiente es crear nuestra escena <code>Maingame</code> en la
carpeta scenes:</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"> * Escena principal de juego.</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@extends</span><span class="co"> </span><span class="cv">Phaser.Scene</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="im">default</span> <span class="kw">class</span> Animation <span class="kw">extends</span> Phaser<span class="op">.</span><span class="at">Scene</span> {</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">constructor</span>() {</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>        <span class="kw">super</span>({ <span class="dt">key</span><span class="op">:</span> <span class="st">&#39;maingame&#39;</span> })<span class="op">;</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">init</span>(){</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">/**</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co">     * Carga de recursos</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="co">     */</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">preload</span>(){</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">load</span><span class="op">.</span><span class="fu">image</span>(<span class="st">&#39;castle&#39;</span><span class="op">,</span> <span class="st">&#39;assets/castle.gif&#39;</span>)<span class="op">;</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>    <span class="co">/**</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="co">    * Creación de los elementos de la escena principal de juego</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="co">    */</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">create</span>() {</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">add</span><span class="op">.</span><span class="fu">image</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="st">&#39;castle&#39;</span>)<span class="op">.</span><span class="fu">setOrigin</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">update</span>(time<span class="op">,</span> dt){</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Vamos a usar los módulos de Javascript, por lo que debemos acceder a
nuestra web a través de un servidor. Para ello, instala Node.js y abre
una terminal en la raiz del proyecto (donde se encuentra el index.html)
para ejecutar:</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> http-server</span></code></pre></div>
<p>Esto deberia abrir un servidor en local, donde se servirá el proyecto
que estamos creando, y al que podrás acceder con
<code>locahost:8080</code> (u otro puerto que te indicará la terminal
donde ejecutaste el comando). Si abrimos esta dirección en nuestro
navegador, deberiamos ver ya el juego de Phaser con nuestro
castillo.</p>
<h1 id="ejercicio-1---enemigos">Ejercicio 1 - Enemigos</h1>
<h2
id="objetivo-conseguir-mostrar-varios-enemigos-en-pantalla">Objetivo:
conseguir mostrar varios enemigos en pantalla</h2>
<p>Lo primero será crear un archivo <code>enemy.js</code> dentro de
<code>/src/enemies/</code> con esta pinta:</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="im">default</span> <span class="kw">class</span> Enemy <span class="kw">extends</span> Phaser<span class="op">.</span><span class="at">GameObjects</span><span class="op">.</span><span class="at">Sprite</span> {</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">/**</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">     * Constructor de Enemigo</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co">     * </span><span class="an">@param</span><span class="co"> </span><span class="cv">{Scene}</span><span class="co"> scene - escena en la que aparece</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co">     * </span><span class="an">@param</span><span class="co"> </span><span class="cv">{number}</span><span class="co"> x - coordenada x</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co">     * </span><span class="an">@param</span><span class="co"> </span><span class="cv">{number}</span><span class="co"> y - coordenada y</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co">     * </span><span class="an">@param</span><span class="co"> </span><span class="cv">{number}</span><span class="co"> y - coordenada y</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co">     */</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">constructor</span>(scene<span class="op">,</span> x<span class="op">,</span> y<span class="op">,</span> life<span class="op">,</span> defense<span class="op">,</span> texture<span class="op">,</span> frame) {</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">super</span>(scene<span class="op">,</span> x<span class="op">,</span> y<span class="op">,</span> texture<span class="op">,</span> frame)<span class="op">;</span> <span class="co">//En la doc de Phaser (https://newdocs.phaser.io/docs/3.86.0/Phaser.GameObjects.Sprite) veremos que</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>        <span class="co">/* el contructor de Sprite recibe 5 parámetros, siendo el último opcional (en la documentación se indica con[])</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co">        el contructor de prite recibe: </span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="co">        scene - Phaser.Scene - The Scene to which this Game Object belongs. A Game Object can only belong to one Scene at a time.</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="co">        x - number - The horizontal position of this Game Object in the world.</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="co">        y - number - The vertical position of this Game Object in the world.</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="co">        texture - string | Phaser.Textures.Texture - The key, or instance of the Texture this Game Object will use to render with, as stored in the Texture Manager.</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="co">        frame - string | number     &lt;optional&gt;  - An optional frame from the Texture this Game Object is rendering with.</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="co">        */</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">life</span> <span class="op">=</span> life<span class="op">;</span> <span class="co">//La vida total que tendrá el enemigo.</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">defense</span> <span class="op">=</span> defense<span class="op">;</span> <span class="co">//La defensa que tendrá el enemigo, reducirá el daño de cada ataque.</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">scene</span><span class="op">.</span><span class="at">add</span><span class="op">.</span><span class="fu">existing</span>(<span class="kw">this</span>)<span class="op">;</span> <span class="co">//Nos añadimos a la escena para ser mostrados.</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>    <span class="co">/**</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a><span class="co">     * Bucle principal del personaje, actualizamos su posición y ejecutamos acciones según el Input</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a><span class="co">     * </span><span class="an">@param</span><span class="co"> </span><span class="cv">{number}</span><span class="co"> t - Tiempo total</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a><span class="co">     * </span><span class="an">@param</span><span class="co"> </span><span class="cv">{number}</span><span class="co"> dt - Tiempo entre frames</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a><span class="co">     */</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">preUpdate</span>(t<span class="op">,</span> dt) {</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Es muy imporante llamar al preUpdate del padre (Sprite), sino no se ejecutará la animación</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>        <span class="kw">super</span><span class="op">.</span><span class="fu">preUpdate</span>(t<span class="op">,</span> dt)<span class="op">;</span> </span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>    <span class="co">/**</span></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a><span class="co">     * Método al que se llamará cuando muera el enemigo</span></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a><span class="co">     */</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">die</span>(){</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>    <span class="co">/**</span></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a><span class="co">    * Método llamado para golpear al enemigo. </span></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a><span class="co">    * </span><span class="an">@param</span><span class="co"> </span><span class="cv">{number}</span><span class="co"> damage - daño recibido, al que se aplicará una reducción por la defensa que tengamos.</span></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a><span class="co">    */</span></span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">hit</span>(damage){</span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">life</span> <span class="op">-=</span> (damage <span class="op">-</span> <span class="kw">this</span><span class="op">.</span><span class="at">defense</span>)<span class="op">;</span></span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>        <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="kw">this</span><span class="op">.</span><span class="at">life</span>)<span class="op">;</span></span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>El siguiente paso es importar nuestro archivo enemy.js en el archivo
maingame.js e instanciar nuestro enemigo desde la escena con:</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">// this es la escena</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co">// vamos a posicionarlo en el centro del canvas con this.sys.game.canvas.width*0.5, this.sys.game.canvas.height*0.5</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">// nuestro enemigo va a tener 20 de vida y 1 de defensa</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co">// además vamos a pintarlo con un spritesheet que tendremos que haber cargado antes en el método preload y cuyo id será &#39;bat&#39;. Lo primero que pintaremos es el primer frame (frame 0)</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="kw">new</span> <span class="fu">Enemy</span>(<span class="kw">this</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">sys</span><span class="op">.</span><span class="at">game</span><span class="op">.</span><span class="at">canvas</span><span class="op">.</span><span class="at">width</span><span class="op">*</span><span class="fl">0.5</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">sys</span><span class="op">.</span><span class="at">game</span><span class="op">.</span><span class="at">canvas</span><span class="op">.</span><span class="at">height</span><span class="op">*</span><span class="fl">0.5</span><span class="op">,</span> <span class="dv">20</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="st">&#39;bat&#39;</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span></code></pre></div>
<p>Cuidado, como estamos llamando a una textura ‘bat’ por lo que
tendremos que haberla precargado en nuestra escena mediante por
ejemplo<code>this.load.spritesheet('bat', 'assets/batIdle.png', {frameWidth: 32, frameHeight: 32})</code>.</p>
<p>Si hemos importado bien la clase Enemy y hecho la carga de la textura
‘bat’, ahora deberemos ver dicho enemigo en el navegador si recargamos
la página. Cuidado, podemos tener la página cacheada en nuestro
navegador, lo mejor es hacer ctr+f5 para recargar y limpiar la página
cacheada.</p>
<h1 id="ejercicio-2---más-enemigos">Ejercicio 2 - Más Enemigos</h1>
<h2
id="objetivo-crear-2-enemigos-diferentes-extendiendo-de-nuestro-enemigo-genérico">Objetivo:
Crear 2 enemigos diferentes extendiendo de nuestro enemigo
genérico.</h2>
<p>Ahora debemos crear dos enemigos nuevos que extiendan de
<code>Enemy</code>, por ejemplo vamos a crear las clases
<code>Bat</code> y a <code>Slime</code>. Por ejemplo <code>Bat</code>
tendrá esta pinta:</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> Enemy <span class="im">from</span> <span class="st">&quot;./enemy.js&quot;</span><span class="op">;</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="im">default</span> <span class="kw">class</span> Bat <span class="kw">extends</span> Enemy{</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">constructor</span>(scene<span class="op">,</span> x<span class="op">,</span> y){</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">super</span>(scene<span class="op">,</span> x<span class="op">,</span> y<span class="op">,</span> <span class="dv">20</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="st">&#39;bat&#39;</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span> <span class="co">//Todos nuestros murciélagos tendrán 20 de vida y 1 de defensa. Estamos llamando al constructor de Enemy, que a su vez llamará al de Sprite de Phaser</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">preUpdate</span>(){</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">super</span><span class="op">.</span><span class="fu">preUpdate</span>()<span class="op">;</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>        <span class="co">//Aquí podríamos dar un movimiento especial a nuestro murciélago</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">die</span>(){</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>        <span class="kw">super</span><span class="op">.</span><span class="fu">die</span>()<span class="op">;</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>        <span class="co">//Aquí podríamos dar una muerte diferente a la de un enemigo común, lanzando alguna animación especial o explotando y haciendo daño a en emigos adyacentes....</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Ahora vamos a animar a nuestro murciélago creando una animación antes
para poder llamarla, en nuestra escena haremos por ejemplos:</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">this</span><span class="op">.</span><span class="at">anims</span><span class="op">.</span><span class="fu">create</span>({</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">key</span><span class="op">:</span> <span class="st">&#39;bat_idle&#39;</span><span class="op">,</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">frames</span><span class="op">:</span> <span class="kw">this</span><span class="op">.</span><span class="at">anims</span><span class="op">.</span><span class="fu">generateFrameNumbers</span>(<span class="st">&#39;bat&#39;</span><span class="op">,</span> {<span class="dt">start</span><span class="op">:</span><span class="dv">0</span><span class="op">,</span> <span class="dt">end</span><span class="op">:</span><span class="dv">3</span>})<span class="op">,</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">frameRate</span><span class="op">:</span> <span class="dv">5</span><span class="op">,</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">repeat</span><span class="op">:</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>En la documentación tenemos más información en <a
href="https://newdocs.phaser.io/docs/3.86.0/Phaser.Animations.AnimationManager#create">Phaser.Animations.AnimationManager#create</a>
y <a
href="https://newdocs.phaser.io/docs/3.86.0/Phaser.Types.Animations.Animation">Phaser.Types.Animations.Animation</a>.</p>
<p>Ahora, al final del constructor de <code>Bat</code> podemos hacer
<code>this.play('bat_idle')</code>. Todos los Sprites de Phaser pueden
llamar a play, y ejecutar cualquier animación creadas. Recordad que
estas son comunes a todo el juego.</p>
<p>Ahora debéis crear a <code>Slime</code> e instanciar ambos en la
escena <code>Maingame</code> en vez de instanciar a
<code>Enemy</code></p>
<h1 id="ejercicio-3---matar-enemigos">Ejercicio 3 - Matar Enemigos</h1>
<h2
id="objetivo-conseguir-que-pulsando-en-los-sprites-de-los-enemigos-se-reduzca-su-vida">Objetivo:
conseguir que pulsando en los sprites de los enemigos se reduzca su
vida.</h2>
<p>Ahora, queremos poder derrotar a estos enemigos que hemos creado.
Para ello, vamos a hacer que el objeto <code>Sprite</code>
(<em>todos</em> los <code>Enemy</code>) sea, interactuable con
<code>sprite.setInteractive()</code>.</p>
<p>Si hemos hecho esto bien, desde la escena, cuando instanciamos los
enemigos podremos escuchar el evento <code>pointerdown</code> para
quitarles vida con por ejemplo:</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>bat<span class="op">.</span><span class="fu">on</span>(<span class="st">&quot;pointerdown&quot;</span><span class="op">,</span> ()<span class="kw">=&gt;</span>{bat<span class="op">.</span><span class="fu">hit</span>(<span class="dv">12</span>)}) <span class="co">//bat es una variable donde hemos guardado el `Bat` instanciado en la escena</span></span></code></pre></div>
<p>Esto deberia mostrar por consola la vida restante del enemigo si le
golpeamos (pulsamos en él). Y debemos hacer lo mismo con el resto de
enemigos que pongamos en pantalla.</p>
<h1 id="ejercicio-4---feedback-visual">Ejercicio 4 - Feedback
visual</h1>
<h2
id="objetivo-proporcionar-feedback-cuando-se-golpea-o-mata-un-enemigo">Objetivo:
Proporcionar feedback cuando se golpea o mata un enemigo.</h2>
<p>Ahora toca añadir el feedback visual. Para ello vamos añadir barras
de vida y haremos que el enemigo se ponga en rojo cuando le golpeamos
(pulsamos en él). Lo primero, y más sencillo es hacer que el enemigo se
ponga rojo. Para ello usaremos la propiedad <code>tint</code>de todos
las imagenes y sprites de Phaser:</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hit</span>(damage){</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">life</span> <span class="op">-=</span> (damage <span class="op">-</span> <span class="kw">this</span><span class="op">.</span><span class="at">defense</span>)<span class="op">;</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="kw">this</span><span class="op">.</span><span class="at">life</span>)<span class="op">;</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">setTint</span>(<span class="bn">0xffff0000</span>) <span class="co">//color ARGB</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Pero ahora tenemos un problema, nuestro enemigo quedará en rojo. Esto
lo vamos a solucionar con los <code>timers</code>de Phaser:</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hit</span>(damage){</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">life</span> <span class="op">-=</span> (damage <span class="op">-</span> <span class="kw">this</span><span class="op">.</span><span class="at">defense</span>)<span class="op">;</span> <span class="co">//this es nuestro murciélago</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="kw">this</span><span class="op">.</span><span class="at">life</span>)<span class="op">;</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">setTint</span>(<span class="bn">0xffff0000</span>) <span class="co">//color ARGB</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">scene</span><span class="op">.</span><span class="at">time</span><span class="op">.</span><span class="fu">addEvent</span>({</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">delay</span><span class="op">:</span> <span class="dv">500</span><span class="op">,</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">callback</span><span class="op">:</span> ()<span class="kw">=&gt;</span>{<span class="kw">this</span><span class="op">.</span><span class="fu">setTint</span>(<span class="bn">0xffffffff</span>)}  <span class="co">//después de 0.5 segundos modificamos a un tinte blanco que dejará la imagen igual</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Ahora nos queda crear las barras de vida de nuestro enemigos. Para
ello vamos a usar la clase <a
href="https://newdocs.phaser.io/docs/3.80.0/Phaser.GameObjects.Rectangle"><code>Phaser.GameObjects.Rectangle</code></a>,
que nos permite dibujar rectángulos de colores.</p>
<p>Nuestra clase para las barras de vida tendrá esta pinta:</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="im">default</span> <span class="kw">class</span> LifeBar <span class="kw">extends</span> Phaser<span class="op">.</span><span class="at">GameObjects</span><span class="op">.</span><span class="at">Rectangle</span>{</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">constructor</span>(scene<span class="op">,</span> x<span class="op">,</span> y){</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>        <span class="kw">super</span>(scene<span class="op">,</span> x<span class="op">,</span> y<span class="op">,</span> <span class="dv">50</span><span class="op">,</span> <span class="dv">8</span><span class="op">,</span> <span class="bn">0xffff0000</span>) <span class="co">// esto crea un rectángulo rojo de 50x8 px </span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>        scene<span class="op">.</span><span class="at">add</span><span class="op">.</span><span class="fu">existing</span>(<span class="kw">this</span>) <span class="co">// y lo añadimos a la escena</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">preUpdate</span>(t<span class="op">,</span> dt){ <span class="co">//podemos aprovechar este método para crear animaciones de la barra de vida.</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>El resultado debería ser algo similar a lo siguiente:</p>
<p><img src="phasercanvas.png"/></p>
<h1 id="ejercicio-4---mejoras-y-juego">Ejercicio 4 - Mejoras y
Juego</h1>
<h2
id="objetivo-mejorar-la-apariencia-añadir-físicas-y-crear-un-ciclo-de-juego">Objetivo:
Mejorar la apariencia, añadir físicas y crear un ciclo de juego.</h2>
<p>Ahora, podemos añadir animaciones de muerte, y hacer algunas mejoras
visuales para que se vea el rectángulo de vida original. También
podríamos jugar con colores de la barra según la vida e incluso añadir
físicas que hicieran que nuestro enemigos voladores cayeran al suelo al
morir.</p>
<p>Vamos a añadir físicas a nuestros enemigos, para que se vean
afectador por la gravedad y tengan colisiones. Esto lo hacemos desde el
enemigo con:</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">this</span><span class="op">.</span><span class="at">scene</span><span class="op">.</span><span class="at">physics</span><span class="op">.</span><span class="at">add</span><span class="op">.</span><span class="fu">existing</span>(<span class="kw">this</span>)<span class="op">;</span> <span class="co">//this es la escena</span></span></code></pre></div>
<p>A partir de este momento, nuestro enemigo tendrá la propiedad
<code>body</code>, su cuerpo físico que además podemos cambiar de tamaño
si lo necesitamos con:</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">this</span><span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="fu">setSize</span>(<span class="dv">16</span><span class="op">,</span><span class="dv">16</span>) <span class="co">//this es el objeto murciélago</span></span></code></pre></div>
<p>Una vez nuestros objetos tienen físicas, debemos indicar que objetos
chocan con que otros objetos. Además, podemos pasar una función como
callback para realizar cambios en nuestro juego en el momento en que
Phaser detecta dicha colisión. Por ejemplo, teniendo creado el suelo,
desde la escena podemos hacer:</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">this</span><span class="op">.</span><span class="at">physics</span><span class="op">.</span><span class="at">add</span><span class="op">.</span><span class="fu">collider</span>(floor<span class="op">,</span> bat<span class="op">,</span> ()<span class="kw">=&gt;</span>{<span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;he pisado suelo&quot;</span>)})<span class="op">;</span> <span class="co">//con esto indicamos que suelo y muciélago colisionan, y si sucede, se llama a la función callback pasada como tercer parámetro (prodíamos no pasar función)</span></span></code></pre></div>
<p>Podéis echarle un ojo a la <a
href="https://newdocs.phaser.io/docs/3.86.0/focus/Phaser.Physics.Arcade.World-addCollider">documentación</a>
y mirar ejemplos.</p>
<p>También podemos hacer que un objeto no se vea afectado por la
gravedad aunque tenga físicas, por ejemplo, no queremos que nuestro
murcielago caiga por la gravedad hasta que no muera. Eso podemos hacerlo
con:</p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">this</span><span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="fu">setAllowGravity</span>(<span class="kw">true</span>)<span class="op">;</span> <span class="co">//this es el objeto murciélago</span></span></code></pre></div>
<p><img src="phasercanvasbody.png"/></p>

<p>Para ir terminando, vamos a convertir esto en un juego. La idea es
tener una pantalla de título y 3 niveles de juego. La escena de título
tendrá un botón START, luego tendremos 3 niveles. El primer nivel
tendremos que matar 1 murciélago, en el segundo nivel 2 de ellos. Y por
último, en el tercer nivel nos encontraremos con 3 murciélagos y un limo
(con más vida y defensa que los murciélagos).</p>
<p>En Phaser, podemos pasar de una escena a otra con <a
href="https://newdocs.phaser.io/docs/3.85.2/Phaser.Scenes.SceneManager#start"><code>scene.start</code></a>:</p>
<div class="sourceCode" id="cb18"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">this</span><span class="op">.</span><span class="at">scene</span><span class="op">.</span><span class="fu">start</span>(<span class="st">&quot;maingame&quot;</span>) <span class="co">//el primer parámetro es el identificador de la escena, el dado en el constructor, como segundo parámetro podemos pasar iformación que recibiremos en la función init()</span></span></code></pre></div>
<p>La idea es que cuando matemos a todos los enemigos de una escena,
pasemos al siguiente nivel. Después de 3 niveles completos, podemos
mostrar un mensaje de haber ganado o volver a la escena de título.</p>
</body>
</html>
